import pyodbc

#Varibalen
server = 'sc-db-server.database.windows.net'
database = 'supplychain'
username = 'rse'
password = 'Pa$$w0rd'

#Verbindung
conn_str = (
    f"DRIVER={{ODBC Driver 17 for SQL Server}};"
    f"SERVER={server};"
    f"DATABASE={database};"
    f"UID={username};"
    f"PWD={password}"
)

try:
    # Verbindung herstellen
    conn = pyodbc.connect(conn_str)
    print("Verbindung erfolgreich hergestellt")

    # Cursor erzeugen
    cursor = conn.cursor()

    # Benutzereingabe
    transport_id = input("Bitte geben Sie eine Transport-ID ein: ")

    # SQL-Abfrage
    abfrage = "SELECT * FROM dbo.coolchain WHERE transportid = ? ORDER BY datetime"
    cursor.execute(abfrage, transport_id)


    # Ergebnisse abrufen und anzeigen
    daten = cursor.fetchall()
    if daten:
        print (f"\nDaten Transport-ID {transport_id}:")
        for datensatz in daten:
            print(datensatz)
    else:
        print(f"Keine Daten für Transport-ID {transport_id} gefunden.")


except Exception as e:
    print("Fehler beim Datenbankzugriff:", e)

finally:
    #Alles im finally:-Block wird immer ausgeführt, egal ob vorher ein Fehler passiert ist oder nicht
    # Verbindung schließen
    if 'cursor' in locals():
        cursor.close()
    if 'conn' in locals():
        conn.close()