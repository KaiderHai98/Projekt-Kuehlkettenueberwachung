<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="de">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Projekt-Kuehlkettenüberwachung: DB_Zugriff_Libary_V3-Namensbereichsreferenz</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Projekt-Kuehlkettenüberwachung
   </div>
   <div id="projectbrief">Dokumentation der Transport- und Temperaturdatenverarbeitung</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Erzeugt von Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Suchen',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('namespace_d_b___zugriff___libary___v3.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Lade ...</div>
<div class="SRStatus" id="Searching">Suche ...</div>
<div class="SRStatus" id="NoMatches">Keine Treffer</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">DB_Zugriff_Libary_V3-Namensbereichsreferenz</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-func-members" class="groupheader"><a id="func-members" name="func-members"></a>
Funktionen</h2></td></tr>
<tr class="memitem:a17a02dece649d17b5b86055c310bfd2d" id="r_a17a02dece649d17b5b86055c310bfd2d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a17a02dece649d17b5b86055c310bfd2d">get_transport_daten</a> (transportid, verbindungs_i)</td></tr>
<tr class="memdesc:a17a02dece649d17b5b86055c310bfd2d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Datenbank Zugriff - Transportdaten ##############################.  <br /></td></tr>
<tr class="memitem:a3edd45e35c3dc8c231d742a393229e75" id="r_a3edd45e35c3dc8c231d742a393229e75"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3edd45e35c3dc8c231d742a393229e75">get_temperatur_daten</a> (transport_daten, verbindungs_i)</td></tr>
<tr class="memdesc:a3edd45e35c3dc8c231d742a393229e75"><td class="mdescLeft">&#160;</td><td class="mdescRight">Datenbank Zugriff - Temperaturdaten #############################.  <br /></td></tr>
<tr class="memitem:a7aea8a7e5fc8bd684fe3d2937fb6ba78" id="r_a7aea8a7e5fc8bd684fe3d2937fb6ba78"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7aea8a7e5fc8bd684fe3d2937fb6ba78">get_company_daten</a> (transport_daten, verbindungs_i)</td></tr>
<tr class="memdesc:a7aea8a7e5fc8bd684fe3d2937fb6ba78"><td class="mdescLeft">&#160;</td><td class="mdescRight">Datenbank Zugriff - Company-Daten ###############################.  <br /></td></tr>
<tr class="memitem:a5048b722f82d51815cf9dadea987bcd8" id="r_a5048b722f82d51815cf9dadea987bcd8"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5048b722f82d51815cf9dadea987bcd8">get_transportstation_daten</a> (transport_daten, verbindungs_i)</td></tr>
<tr class="memdesc:a5048b722f82d51815cf9dadea987bcd8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Datenbank Zugriff - Transportstations-Daten #####################.  <br /></td></tr>
</table>
<a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Dokumentation der Funktionen</h2>
<a id="a7aea8a7e5fc8bd684fe3d2937fb6ba78" name="a7aea8a7e5fc8bd684fe3d2937fb6ba78"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7aea8a7e5fc8bd684fe3d2937fb6ba78">&#9670;&#160;</a></span>get_company_daten()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">DB_Zugriff_Libary_V3.get_company_daten </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>transport_daten</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>verbindungs_i</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Datenbank Zugriff - Company-Daten ###############################. </p>
<p>Liest Firmendaten aus der Tabelle <em>company</em> basierend auf den in den Transportdaten enthaltenen Company-IDs.</p>
<p>Die Funktion extrahiert alle eindeutigen Company-IDs aus den übergebenen Transportdaten und ruft für jede ID die zugehörigen Datensätze aus der Tabelle <em>dbo.company</em> ab. Jede gefundene Zeile wird als Liste der Spaltenwerte in einem Dictionary gespeichert, wobei der Schlüssel ein fortlaufender Index (beginnend bei 1) ist.</p>
<p>Zusätzlich wird die Gesamtanzahl der gefundenen Firmendatensätze zurückgegeben. Bei einem Fehler im Datenbankzugriff wird eine Fehlermeldung ausgegeben und ein leeres Dictionary sowie die Länge 0 zurückgegeben. Die Datenbankverbindung und der Cursor werden im <span class="tt">finally</span>-Block zuverlässig geschlossen. </p>

<p class="definition">Definiert in Zeile <a class="el" href="_d_b___zugriff___libary___v3_8py_source.html#l00186">186</a> der Datei <a class="el" href="_d_b___zugriff___libary___v3_8py_source.html">DB_Zugriff_Libary_V3.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  186</span>    Die Datenbankverbindung und der Cursor werden im `<span class="keywordflow">finally</span>`-Block zuverlässig geschlossen.</div>
<div class="line"><span class="lineno">  187</span>    <span class="stringliteral">&#39;&#39;&#39;</span></div>
<div class="line"><span class="lineno">  188</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  189</span><span class="stringliteral">    company_daten = {}</span></div>
<div class="line"><span class="lineno">  190</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  191</span><span class="stringliteral">    try:</span></div>
<div class="line"><span class="lineno">  192</span><span class="stringliteral">        conn = pyodbc.connect(verbindungs_i)</span></div>
<div class="line"><span class="lineno">  193</span><span class="stringliteral">        cursor = conn.cursor()</span></div>
<div class="line"><span class="lineno">  194</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  195</span><span class="stringliteral">        sql = &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  196</span><span class="stringliteral">            SELECT *</span></div>
<div class="line"><span class="lineno">  197</span><span class="stringliteral">            FROM dbo.company</span></div>
<div class="line"><span class="lineno">  198</span><span class="stringliteral">            WHERE companyID = ?</span></div>
<div class="line"><span class="lineno">  199</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  200</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  201</span><span class="stringliteral">        # Eindeutige companyIDs aus transport_daten (Index 1 = zweite Spalte)</span></div>
<div class="line"><span class="lineno">  202</span><span class="stringliteral">        company_ids = {eintrag[1] for eintrag in transport_daten.values()}</span></div>
<div class="line"><span class="lineno">  203</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  204</span><span class="stringliteral">        idx = 1</span></div>
<div class="line"><span class="lineno">  205</span><span class="stringliteral">        for companyID in company_ids:</span></div>
<div class="line"><span class="lineno">  206</span><span class="stringliteral">            cursor.execute(sql, companyID)</span></div>
<div class="line"><span class="lineno">  207</span><span class="stringliteral">            zeilen = cursor.fetchall()</span></div>
<div class="line"><span class="lineno">  208</span><span class="stringliteral">            for zeile in zeilen:</span></div>
<div class="line"><span class="lineno">  209</span><span class="stringliteral">                company_daten[idx] = list(zeile)</span></div>
<div class="line"><span class="lineno">  210</span><span class="stringliteral">                idx += 1</span></div>
<div class="line"><span class="lineno">  211</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  212</span><span class="stringliteral">        company_daten_len = len(company_daten)</span></div>
<div class="line"><span class="lineno">  213</span><span class="stringliteral">        return company_daten, company_daten_len</span></div>
<div class="line"><span class="lineno">  214</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  215</span><span class="stringliteral">    except Exception as e:</span></div>
<div class="line"><span class="lineno">  216</span><span class="stringliteral">        print(&quot;Fehler beim Datenbankzugriff - Company Daten:&quot;, e)</span></div>
<div class="line"><span class="lineno">  217</span><span class="stringliteral">        return {}, 0</span></div>
<div class="line"><span class="lineno">  218</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  219</span><span class="stringliteral">    finally:</span></div>
<div class="line"><span class="lineno">  220</span><span class="stringliteral">        if &#39;cursor&#39; in locals():</span></div>
<div class="line"><span class="lineno">  221</span><span class="stringliteral">            cursor.close()</span></div>
<div class="line"><span class="lineno">  222</span><span class="stringliteral">        if &#39;conn&#39; in locals():</span></div>
<div class="line"><span class="lineno">  223</span><span class="stringliteral">            conn.close()</span></div>
<div class="line"><span class="lineno">  224</span><span class="stringliteral">        print(company_daten)  # optional</span></div>
<div class="line"><span class="lineno">  225</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  226</span><span class="stringliteral"></span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a3edd45e35c3dc8c231d742a393229e75" name="a3edd45e35c3dc8c231d742a393229e75"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3edd45e35c3dc8c231d742a393229e75">&#9670;&#160;</a></span>get_temperatur_daten()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">DB_Zugriff_Libary_V3.get_temperatur_daten </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>transport_daten</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>verbindungs_i</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Datenbank Zugriff - Temperaturdaten #############################. </p>
<p>Liest Temperaturdaten zu Transportstationen aus der Tabelle <em>tempdata</em> basierend auf Transportdaten.</p>
<p>Die Funktion nutzt zuvor geladene Transportdaten, um für jede Station und jeden "Check-in"-Zeitpunkt (<em>Status = 'in'</em>) die zugehörigen Temperaturmessungen aus der Tabelle <em>dbo.tempdata</em> abzurufen. Dabei wird jeweils der Zeitraum zwischen dem "in"- und dem nächsten "out"-Eintrag derselben Station berücksichtigt. Fehlt ein "out"-Eintrag, werden alle Messungen ab dem Startzeitpunkt einbezogen.</p>
<p>Die Ergebnisse werden als Dictionary mit fortlaufendem Index (beginnend bei 1) gespeichert, wobei jede Zeile als Liste der Spaltenwerte vorliegt. Zusätzlich wird die Gesamtanzahl der gefundenen Temperaturdatensätze zurückgegeben.</p>
<p>Bei einem Fehler im Datenbankzugriff wird eine Fehlermeldung ausgegeben und ein leeres Dictionary zurückgegeben. Die Datenbankverbindung und der Cursor werden im <span class="tt">finally</span>-Block zuverlässig geschlossen. </p>

<p class="definition">Definiert in Zeile <a class="el" href="_d_b___zugriff___libary___v3_8py_source.html#l00093">93</a> der Datei <a class="el" href="_d_b___zugriff___libary___v3_8py_source.html">DB_Zugriff_Libary_V3.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   93</span>    Die Datenbankverbindung und der Cursor werden im `<span class="keywordflow">finally</span>`-Block zuverlässig geschlossen.</div>
<div class="line"><span class="lineno">   94</span>    <span class="stringliteral">&#39;&#39;&#39;</span></div>
<div class="line"><span class="lineno">   95</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   96</span><span class="stringliteral">    temperatur_daten = {}</span></div>
<div class="line"><span class="lineno">   97</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   98</span><span class="stringliteral">    try:</span></div>
<div class="line"><span class="lineno">   99</span><span class="stringliteral">        conn = pyodbc.connect(verbindungs_i)</span></div>
<div class="line"><span class="lineno">  100</span><span class="stringliteral">        cursor = conn.cursor()</span></div>
<div class="line"><span class="lineno">  101</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  102</span><span class="stringliteral">        # SQL-Abfragen</span></div>
<div class="line"><span class="lineno">  103</span><span class="stringliteral">        sql_ohne_end = &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  104</span><span class="stringliteral">            SELECT *</span></div>
<div class="line"><span class="lineno">  105</span><span class="stringliteral">            FROM dbo.tempdata</span></div>
<div class="line"><span class="lineno">  106</span><span class="stringliteral">            WHERE transportstationID = ?</span></div>
<div class="line"><span class="lineno">  107</span><span class="stringliteral">              AND datetime &gt;= ?</span></div>
<div class="line"><span class="lineno">  108</span><span class="stringliteral">            ORDER BY datetime</span></div>
<div class="line"><span class="lineno">  109</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  110</span><span class="stringliteral">        sql_mit_end = &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  111</span><span class="stringliteral">            SELECT *</span></div>
<div class="line"><span class="lineno">  112</span><span class="stringliteral">            FROM dbo.tempdata</span></div>
<div class="line"><span class="lineno">  113</span><span class="stringliteral">            WHERE transportstationID = ?</span></div>
<div class="line"><span class="lineno">  114</span><span class="stringliteral">              AND datetime &gt;= ?</span></div>
<div class="line"><span class="lineno">  115</span><span class="stringliteral">              AND datetime &lt; ?</span></div>
<div class="line"><span class="lineno">  116</span><span class="stringliteral">            ORDER BY datetime</span></div>
<div class="line"><span class="lineno">  117</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  118</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  119</span><span class="stringliteral">        # Reihenfolge sicherstellen (dein transport_daten kommt i. d. R. schon sortiert)</span></div>
<div class="line"><span class="lineno">  120</span><span class="stringliteral">        items = sorted(transport_daten.items(), key=lambda kv: kv[0])</span></div>
<div class="line"><span class="lineno">  121</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  122</span><span class="stringliteral">        idx = 1</span></div>
<div class="line"><span class="lineno">  123</span><span class="stringliteral">        for pos, (_, eintrag) in enumerate(items):</span></div>
<div class="line"><span class="lineno">  124</span><span class="stringliteral">            station_id = eintrag[3]</span></div>
<div class="line"><span class="lineno">  125</span><span class="stringliteral">            status_raw = str(eintrag[4])           # z.B. &quot;&#39;in&#39;&quot;</span></div>
<div class="line"><span class="lineno">  126</span><span class="stringliteral">            status = status_raw.strip().strip(&quot;&#39;&quot;).lower()</span></div>
<div class="line"><span class="lineno">  127</span><span class="stringliteral">            start_dt = eintrag[5]</span></div>
<div class="line"><span class="lineno">  128</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  129</span><span class="stringliteral">            # Nur wenn Ware eingecheckt ist</span></div>
<div class="line"><span class="lineno">  130</span><span class="stringliteral">            if status != &quot;in&quot;:</span></div>
<div class="line"><span class="lineno">  131</span><span class="stringliteral">                continue</span></div>
<div class="line"><span class="lineno">  132</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  133</span><span class="stringliteral">            # Nächsten &#39;out&#39; für dieselbe Station suchen</span></div>
<div class="line"><span class="lineno">  134</span><span class="stringliteral">            end_dt = None</span></div>
<div class="line"><span class="lineno">  135</span><span class="stringliteral">            for _, next_entry in items[pos+1:]:</span></div>
<div class="line"><span class="lineno">  136</span><span class="stringliteral">                if next_entry[3] == station_id:</span></div>
<div class="line"><span class="lineno">  137</span><span class="stringliteral">                    next_status = str(next_entry[4]).strip().strip(&quot;&#39;&quot;).lower()</span></div>
<div class="line"><span class="lineno">  138</span><span class="stringliteral">                    if next_status == &quot;out&quot;:</span></div>
<div class="line"><span class="lineno">  139</span><span class="stringliteral">                        end_dt = next_entry[5]</span></div>
<div class="line"><span class="lineno">  140</span><span class="stringliteral">                        break</span></div>
<div class="line"><span class="lineno">  141</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  142</span><span class="stringliteral">            # Abfrage ausführen (mit oder ohne Endzeit)</span></div>
<div class="line"><span class="lineno">  143</span><span class="stringliteral">            if end_dt is None:</span></div>
<div class="line"><span class="lineno">  144</span><span class="stringliteral">                cursor.execute(sql_ohne_end, station_id, start_dt)</span></div>
<div class="line"><span class="lineno">  145</span><span class="stringliteral">            else:</span></div>
<div class="line"><span class="lineno">  146</span><span class="stringliteral">                cursor.execute(sql_mit_end, station_id, start_dt, end_dt)</span></div>
<div class="line"><span class="lineno">  147</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  148</span><span class="stringliteral">            zeilen = cursor.fetchall()</span></div>
<div class="line"><span class="lineno">  149</span><span class="stringliteral">            for zeile in zeilen:</span></div>
<div class="line"><span class="lineno">  150</span><span class="stringliteral">                temperatur_daten[idx] = list(zeile)</span></div>
<div class="line"><span class="lineno">  151</span><span class="stringliteral">                idx += 1</span></div>
<div class="line"><span class="lineno">  152</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  153</span><span class="stringliteral">        temperatur_daten_len = len(temperatur_daten)</span></div>
<div class="line"><span class="lineno">  154</span><span class="stringliteral">        return temperatur_daten, temperatur_daten_len</span></div>
<div class="line"><span class="lineno">  155</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  156</span><span class="stringliteral">    except Exception as e:</span></div>
<div class="line"><span class="lineno">  157</span><span class="stringliteral">        print(&quot;Fehler beim Datenbankzugriff - Temperaturdaten:&quot;, e)</span></div>
<div class="line"><span class="lineno">  158</span><span class="stringliteral">        return {}</span></div>
<div class="line"><span class="lineno">  159</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  160</span><span class="stringliteral">    finally:</span></div>
<div class="line"><span class="lineno">  161</span><span class="stringliteral">        if &#39;cursor&#39; in locals():</span></div>
<div class="line"><span class="lineno">  162</span><span class="stringliteral">            cursor.close()</span></div>
<div class="line"><span class="lineno">  163</span><span class="stringliteral">        if &#39;conn&#39; in locals():</span></div>
<div class="line"><span class="lineno">  164</span><span class="stringliteral">            conn.close()</span></div>
<div class="line"><span class="lineno">  165</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  166</span><span class="stringliteral">        print(temperatur_daten)</span></div>
<div class="line"><span class="lineno">  167</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  168</span><span class="stringliteral"></span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a17a02dece649d17b5b86055c310bfd2d" name="a17a02dece649d17b5b86055c310bfd2d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a17a02dece649d17b5b86055c310bfd2d">&#9670;&#160;</a></span>get_transport_daten()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">DB_Zugriff_Libary_V3.get_transport_daten </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>transportid</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>verbindungs_i</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Datenbank Zugriff - Transportdaten ##############################. </p>
<p>Liest Transportdaten aus der Datenbanktabelle <em>coolchain</em> anhand einer gegebenen Transport-ID.</p>
<p>Die Funktion stellt eine Verbindung zur angegebenen SQL-Datenbank her, führt eine Abfrage auf der Tabelle <em>dbo.coolchain</em> aus und sammelt alle Datensätze mit der passenden Transport-ID. Die Ergebnisse werden nach dem Zeitstempel (<em>datetime</em>) sortiert und als Dictionary zurückgegeben, wobei der Schlüssel dem laufenden Index (beginnend bei 1) entspricht und der Wert eine Liste der Spaltenwerte ist. Zusätzlich wird die Gesamtanzahl der gefundenen Datensätze ermittelt. Bei einem Fehler wird eine Fehlermeldung ausgegeben und ein leeres Dictionary zurückgegeben. Die Datenbankverbindung sowie der Cursor werden am Ende der Funktion zuverlässig geschlossen. </p>

<p class="definition">Definiert in Zeile <a class="el" href="_d_b___zugriff___libary___v3_8py_source.html#l00033">33</a> der Datei <a class="el" href="_d_b___zugriff___libary___v3_8py_source.html">DB_Zugriff_Libary_V3.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   33</span>    Die Datenbankverbindung sowie der Cursor werden am Ende der Funktion zuverlässig geschlossen.</div>
<div class="line"><span class="lineno">   34</span>    <span class="stringliteral">&#39;&#39;&#39;</span></div>
<div class="line"><span class="lineno">   35</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   36</span><span class="stringliteral">    transport_daten = {}</span></div>
<div class="line"><span class="lineno">   37</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   38</span><span class="stringliteral">    try:</span></div>
<div class="line"><span class="lineno">   39</span><span class="stringliteral">        # Verbindung herstellen</span></div>
<div class="line"><span class="lineno">   40</span><span class="stringliteral">        conn = pyodbc.connect(verbindungs_i)</span></div>
<div class="line"><span class="lineno">   41</span><span class="stringliteral">        cursor = conn.cursor()</span></div>
<div class="line"><span class="lineno">   42</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   43</span><span class="stringliteral">        # SQL-Abfrage</span></div>
<div class="line"><span class="lineno">   44</span><span class="stringliteral">        abfrage = &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   45</span><span class="stringliteral">            SELECT * </span></div>
<div class="line"><span class="lineno">   46</span><span class="stringliteral">            FROM dbo.coolchain </span></div>
<div class="line"><span class="lineno">   47</span><span class="stringliteral">            WHERE transportid = ? </span></div>
<div class="line"><span class="lineno">   48</span><span class="stringliteral">            ORDER BY datetime</span></div>
<div class="line"><span class="lineno">   49</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   50</span><span class="stringliteral">        cursor.execute(abfrage, transportid)</span></div>
<div class="line"><span class="lineno">   51</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   52</span><span class="stringliteral">        zeilen = cursor.fetchall()</span></div>
<div class="line"><span class="lineno">   53</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   54</span><span class="stringliteral">        for idx, zeile in enumerate(zeilen, start=1):</span></div>
<div class="line"><span class="lineno">   55</span><span class="stringliteral">            # Row ist ein pyodbc.Row -&gt; in Liste konvertieren</span></div>
<div class="line"><span class="lineno">   56</span><span class="stringliteral">            transport_daten[idx] = list(zeile)</span></div>
<div class="line"><span class="lineno">   57</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   58</span><span class="stringliteral">        transport_daten_len = len(transport_daten)</span></div>
<div class="line"><span class="lineno">   59</span><span class="stringliteral">        return transport_daten, transport_daten_len</span></div>
<div class="line"><span class="lineno">   60</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   61</span><span class="stringliteral">    except Exception as e:</span></div>
<div class="line"><span class="lineno">   62</span><span class="stringliteral">        print(&quot;Fehler beim Datenbankzugriff - Transportdaten:&quot;, e)</span></div>
<div class="line"><span class="lineno">   63</span><span class="stringliteral">        return {}</span></div>
<div class="line"><span class="lineno">   64</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   65</span><span class="stringliteral">    finally:</span></div>
<div class="line"><span class="lineno">   66</span><span class="stringliteral">        if &#39;cursor&#39; in locals():</span></div>
<div class="line"><span class="lineno">   67</span><span class="stringliteral">            cursor.close()</span></div>
<div class="line"><span class="lineno">   68</span><span class="stringliteral">        if &#39;conn&#39; in locals():</span></div>
<div class="line"><span class="lineno">   69</span><span class="stringliteral">            conn.close()</span></div>
<div class="line"><span class="lineno">   70</span><span class="stringliteral">        </span></div>
<div class="line"><span class="lineno">   71</span><span class="stringliteral">        print(transport_daten)</span></div>
<div class="line"><span class="lineno">   72</span><span class="stringliteral">    </span></div>
<div class="line"><span class="lineno">   73</span><span class="stringliteral"></span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a5048b722f82d51815cf9dadea987bcd8" name="a5048b722f82d51815cf9dadea987bcd8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5048b722f82d51815cf9dadea987bcd8">&#9670;&#160;</a></span>get_transportstation_daten()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">DB_Zugriff_Libary_V3.get_transportstation_daten </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>transport_daten</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>verbindungs_i</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Datenbank Zugriff - Transportstations-Daten #####################. </p>
<p>Liest Daten zu Transportstationen aus der Tabelle <em>transportstation</em> anhand der in den Transportdaten enthaltenen Station-IDs.</p>
<p>Die Funktion extrahiert alle eindeutigen Transportstations-IDs aus den übergebenen Transportdaten und ruft für jede ID die zugehörigen Datensätze aus der Tabelle <em>dbo.transportstation</em> ab. Jede gefundene Zeile wird als Liste der Spaltenwerte in einem Dictionary gespeichert, wobei der Schlüssel ein fortlaufender Index (beginnend bei 1) ist.</p>
<p>Zusätzlich wird die Gesamtanzahl der gefundenen Transportstationsdatensätze zurückgegeben. Bei einem Fehler im Datenbankzugriff wird eine Fehlermeldung ausgegeben und ein leeres Dictionary sowie die Länge 0 zurückgegeben. Die Datenbankverbindung und der Cursor werden im <span class="tt">finally</span>-Block zuverlässig geschlossen. </p>

<p class="definition">Definiert in Zeile <a class="el" href="_d_b___zugriff___libary___v3_8py_source.html#l00244">244</a> der Datei <a class="el" href="_d_b___zugriff___libary___v3_8py_source.html">DB_Zugriff_Libary_V3.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  244</span>    Die Datenbankverbindung und der Cursor werden im `<span class="keywordflow">finally</span>`-Block zuverlässig geschlossen.</div>
<div class="line"><span class="lineno">  245</span>    <span class="stringliteral">&#39;&#39;&#39;</span></div>
<div class="line"><span class="lineno">  246</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  247</span><span class="stringliteral">    transportstation_daten = {}</span></div>
<div class="line"><span class="lineno">  248</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  249</span><span class="stringliteral">    try:</span></div>
<div class="line"><span class="lineno">  250</span><span class="stringliteral">        conn = pyodbc.connect(verbindungs_i)</span></div>
<div class="line"><span class="lineno">  251</span><span class="stringliteral">        cursor = conn.cursor()</span></div>
<div class="line"><span class="lineno">  252</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  253</span><span class="stringliteral">        sql = &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  254</span><span class="stringliteral">            SELECT *</span></div>
<div class="line"><span class="lineno">  255</span><span class="stringliteral">            FROM dbo.transportstation</span></div>
<div class="line"><span class="lineno">  256</span><span class="stringliteral">            WHERE transportstationID = ?</span></div>
<div class="line"><span class="lineno">  257</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  258</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  259</span><span class="stringliteral">        # Eindeutige transportstationIDs aus transport_daten (Index 3 = 4. Spalte)</span></div>
<div class="line"><span class="lineno">  260</span><span class="stringliteral">        station_ids = {eintrag[3] for eintrag in transport_daten.values()}</span></div>
<div class="line"><span class="lineno">  261</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  262</span><span class="stringliteral">        idx = 1</span></div>
<div class="line"><span class="lineno">  263</span><span class="stringliteral">        for transportstationID in station_ids:</span></div>
<div class="line"><span class="lineno">  264</span><span class="stringliteral">            cursor.execute(sql, transportstationID)</span></div>
<div class="line"><span class="lineno">  265</span><span class="stringliteral">            zeilen = cursor.fetchall()</span></div>
<div class="line"><span class="lineno">  266</span><span class="stringliteral">            for zeile in zeilen:</span></div>
<div class="line"><span class="lineno">  267</span><span class="stringliteral">                transportstation_daten[idx] = list(zeile)</span></div>
<div class="line"><span class="lineno">  268</span><span class="stringliteral">                idx += 1</span></div>
<div class="line"><span class="lineno">  269</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  270</span><span class="stringliteral">        transportstation_daten_len = len(transportstation_daten)</span></div>
<div class="line"><span class="lineno">  271</span><span class="stringliteral">        return transportstation_daten, transportstation_daten_len</span></div>
<div class="line"><span class="lineno">  272</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  273</span><span class="stringliteral">    except Exception as e:</span></div>
<div class="line"><span class="lineno">  274</span><span class="stringliteral">        print(&quot;Fehler beim Datenbankzugriff - transportstation Daten:&quot;, e)</span></div>
<div class="line"><span class="lineno">  275</span><span class="stringliteral">        return {}, 0</span></div>
<div class="line"><span class="lineno">  276</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  277</span><span class="stringliteral">    finally:</span></div>
<div class="line"><span class="lineno">  278</span><span class="stringliteral">        if &#39;cursor&#39; in locals():</span></div>
<div class="line"><span class="lineno">  279</span><span class="stringliteral">            cursor.close()</span></div>
<div class="line"><span class="lineno">  280</span><span class="stringliteral">        if &#39;conn&#39; in locals():</span></div>
<div class="line"><span class="lineno">  281</span><span class="stringliteral">            conn.close()</span></div>
<div class="line"><span class="lineno">  282</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  283</span><span class="stringliteral">        print(transportstation_daten)</span></div>
<div class="line"><span class="lineno">  284</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  285</span><span class="stringliteral"></span> </div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="namespace_d_b___zugriff___libary___v3.html">DB_Zugriff_Libary_V3</a></li>
    <li class="footer">Erzeugt von <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
